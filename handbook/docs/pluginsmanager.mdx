---
id: pluginsmanager
title: 插件系统
---

## 说明
插件系统是一组能实现多播订阅的，可中断的触发器。其设计核心来自于Aspnetcore的中间件，它有着和中间件一样的使用体验，同时也有着更高的灵活性和自由度。

## 产品特点

- 简单易用。
- 易扩展。

## 产品应用场景

- 所有可以使用事件。委托的场景。

## 与事件、委托相比

#### 优点

1. 订阅的时候可以不用知道被订阅方是谁，只需要知道要订阅什么通知即可。
2. 订阅可以随时中断。例如：当事件多播的时候，即使其中一个订阅方已经处理，触发也不会停止，这样会造成资源浪费。
3. 订阅回调。例如：第一个订阅方，想知道本次触发的最终结果是否已被处理时，委托则做不到。而插件则可以。

#### 缺点

1. 使用插件会损耗一部分性能。但是一般如果不是千万级别的，不会有明显的差距。

## 插件特性

【执行顺序】
每个插件都有一个**Order**属性，该属性表示该插件的执行顺序，数值大，越提前执行（Order在Add之前生效，后续修改无效）。

【中断传递】
当某个插件在响应时，如果设置e.Handled=true,则该数据将**不会**再触发后续的插件、事件、重写方法。

## 用户自定义插件
用户通过实现框架预设的插件接口，即可接收相应的触发。每个组件都有详细的插件支持说明。

例如：**ITcpPlugin**、**ITokenPlugin**、**IProtocolPlugin**等。

## 系统自定义插件
当各位朋友使用TouchSocket封装自己的dll时，可能需要一些定义插件。那么这个需求TouchSocket也能满足大家。
> 例如：实现基于TCP的特殊信息自定义插件，当收到字母‘A’时，希望触发实现IAPlugin接口插件的GoToA方法。

具体操作如下：

1. 声明IAPlugin接口，继承**IPlugin**。
2. 声明GoToA接口方法（该方法必须**两个**参数，第一参数无要求，一般为触发主体，第二参数**必须继承**自**TouchSocketEventArgs**）。
3. 在合适时候，判断当前配置是否支持插件，然后使用服务器或客户端的**PluginsManager**属性调用**Raise**方法，此处的泛型（**IAPlugin**）必须为接口类型。

```csharp
public interface IAPlugin : IPlugin
{
    void GoToA(ITcpClientBase client,TouchSocketEventArgs e);
}
```

```csharp
public class MyTClient : TcpClient
{
    protected override void HandleReceivedData(ByteBlock byteBlock, IRequestInfo requestInfo)
    {
        if (this.UsePlugin)
        {
            if (byteBlock.ToString()=="A")
            {
                this.PluginsManager.Raise<IAPlugin>("GoToA",this,new TouchSocketEventArgs());
            }
        }
    }
}
```
