---
id: generichost
title: 通用主机
---

import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";

### 定义

命名空间：TouchSocket.Hosting <br/>
程序集：[TouchSocket.Hosting.dll](https://www.nuget.org/packages/TouchSocket.Hosting)<br/>
程序集：[TouchSocketPro.Hosting.dll](https://www.nuget.org/packages/TouchSocketPro.Hosting)


## 一、说明

Hosting通用主机，是在创建一个[HostBuilder](https://learn.microsoft.com/zh-cn/dotnet/core/extensions/generic-host) 之后，可以通过Add的服务的形式创建`TouchSocket`的一些组件。如`TcpService`、`TcpClient`、`NamedPipeService`、`NamedPipeclient`等。


## 二、安装Nuget包

在安装Nuget之前，最好先确认目标项目是一个主机项目。例如：[辅助角色服务模板](https://learn.microsoft.com/zh-cn/dotnet/core/extensions/generic-host)、 [AspNetCore](https://learn.microsoft.com/zh-cn/aspnet/core)等。如果是其他项目，请自行解决依赖。

使用Nuget安装`TouchSocket.Hosting`、`TouchSocketPro.Hosting`、`TouchSocket.AspNetCore`、`TouchSocketPro.AspNetCore`其中的**任意一个**。

:::info 备注

`TouchSocket.Hosting`、`TouchSocketPro.Hosting`、`TouchSocket.AspNetCore`、`TouchSocketPro.AspNetCore`都可以安装使用。主要区别就是：Hosting的只包含基础扩展。AspNetCore的会对Web项目有更多扩展。

:::  

:::tip 建议

一般建议Web项目使用`TouchSocket.AspNetCore`、`TouchSocketPro.AspNetCore`。辅助角色项目、MAUI项目等使用`TouchSocket.Hosting`、`TouchSocketPro.Hosting`。

:::  

## 三、添加服务

一些常用的组件，都已经被封装了，可以直接使用。例如：

- TcpService
- TcpClient
- 等

### 3.1 在Aspnetcore中添加

但是如果想添加自己的服务，或者想注入同一类型的服务，则需要重新实现。例如：添加自己的TcpService。

首先需要声明一个接口`IMyTcpService`，继承自`ITcpService`，然后声明自定义类`MyTcpService`，继承`TcpService`，同时实现`IMyTcpService`。

```csharp showLineNumbers
class MyTcpService : TcpService, IMyTcpService
{

}

interface IMyTcpService : ITcpService
{

}
```

然后调用AddServiceHostedService即可。

```csharp showLineNumbers
services.AddServiceHostedService<IMyTcpService, MyTcpService>(config =>
{
    config.SetListenIPHosts(7790);
});
```

:::tip 提示

`AddServiceHostedService`适用于任何基于`IService`的服务，例如`NamedPipeService`。如果是客户端，请使用`AddClientHostedService`。

:::  

:::tip 提示

当想要注入两个`TcpService`时，如果调用两次`AddTcpService`，则在容器中会替换掉第一次添加的项。所以也需要使用该方法实现。

:::  

[本文示例Demo](https://gitee.com/RRQM_Home/TouchSocket/tree/master/examples/Hosting)